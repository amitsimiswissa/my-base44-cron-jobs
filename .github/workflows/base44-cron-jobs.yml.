name: Base44 Cron Jobs

on:
  # --- Trigger for Process Scheduled Emails (every 10 minutes) ---
  schedule:
    - cron: '*/10 * * * *'

  # --- Trigger for Process Report Schedules (every hour) ---
  schedule:
    - cron: '0 * * * *' # At minute 0 past every hour

  # --- Trigger for Check Cadence Replies (every 30 minutes) ---
  schedule:
    - cron: '*/30 * * * *'

  # Allow manual trigger from GitHub Actions tab for testing
  workflow_dispatch:

jobs:
  process-scheduled-emails:
    runs-on: ubuntu-latest
    # Only run this job if the triggering schedule is '*/10 * * * *' or manual dispatch
    if: github.event_name == 'workflow_dispatch' || github.event.schedule == '*/10 * * * *'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Call processScheduledEmails function
        run: |
          curl -X POST \
          https://base44.app/api/apps/6853c86e704151cd98ca0a3e/functions/processScheduledEmails \
          -H 'Content-Type: application/json' \
          -d '{}'

  process-report-schedules:
    runs-on: ubuntu-latest
    # Only run this job if the triggering schedule is '0 * * * *' or manual dispatch
    if: github.event_name == 'workflow_dispatch' || github.event.schedule == '0 * * * *'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Call processReportSchedules function
        run: |
          curl -X POST \
          https://base44.app/api/apps/6853c86e704151cd98ca0a3e/functions/processReportSchedules \
          -H 'Content-Type: application/json' \
          -d '{}'

  check-cadence-replies:
    runs-on: ubuntu-latest
    # Only run this job if the triggering schedule is '*/30 * * * *' or manual dispatch
    if: github.event_name == 'workflow_dispatch' || github.event.schedule == '*/30 * * * *'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Call checkCadenceReplies function
        run: |
          curl -X POST \
          https://base44.app/api/apps/6853c86e704151cd98ca0a3e/functions/checkCadenceReplies \
          -H 'Content-Type: application/json' \
          -d '{}'
